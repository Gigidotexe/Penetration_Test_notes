# RDP Enumeration

RDP (Remote Desktop Protocol) è un protocollo sviluppato da Microsoft che consente l’accesso remoto a un desktop grafico su macchine Windows. La porta predefinita è la `3389/TCP`.

## Perché l’RDP è importante nel pentesting?

Se trovi RDP aperto durante una scansione, significa che potresti accedere direttamente all’interfaccia grafica di Windows, proprio come se fossi seduto davanti al monitor. Questo livello di accesso è spesso **molto privilegiato**.

Tuttavia, RDP **non è sfruttabile facilmente a livello di protocollo**, a meno che:

- Non vi siano **vulnerabilità note** (es. BlueKeep)
- Le **credenziali** siano deboli o note
- La configurazione sia mal gestita

## Fase 1 – Scansione con Nmap

Per verificare la presenza del servizio RDP:

`nmap -p 3389 -sV <IP>`

Per usare script specifici:

`nmap -p 3389 --script rdp-ntlm-info <IP>`

Questo script cerca di ottenere informazioni tramite l’handshake NTLM, e può restituire:

- Nome del dominio
- Nome della macchina
- Versione del sistema operativo

Se il server RDP è configurato senza restrizioni, questo script può rivelare metadati utili anche **senza autenticazione**.

## Fase 2 – Verifica manuale

Puoi provare a collegarti con:

- Linux: `xfreerdp /v:<IP>`
- Kali: `rdesktop <IP>`
- Windows: `mstsc.exe` (l'app "Connessione Desktop Remoto")

Se riesci a connetterti, potresti ottenere:

- Un prompt di login
- Un banner
- Un errore che ti informa del tipo di dominio, utente o versione

In ogni caso, ogni messaggio è utile. Alcuni sistemi restituiscono errori del tipo:

- “L’utente non è autorizzato a connettersi” → l’utente esiste ma non ha accesso remoto
- “Username o password errata” → il nome utente è valido
- “Nessun dominio specificato” → il server non è parte di un dominio

## Fase 3 – Enumerazione utenti con RDP (metodo timing)

Alcuni tool tentano di determinare se un utente esiste basandosi sul tempo di risposta del servizio RDP durante una connessione fallita. È una forma di **user enumeration passiva**, simile al comportamento di SSH.

Strumenti come `rdp-sec-check` o `Crowbar` (per brute-force RDP) possono essere usati per testare utenti.

## Fase 4 – Brute-force RDP (con cautela)

Attenzione: il brute-force su RDP può facilmente far scattare blocchi di account, log di sistema e allarmi.

### Con Hydra:

`hydra -t 4 -V -f -l <user> -P <wordlist> rdp://<IP>`

### Con Ncrack:

`ncrack -p 3389 -u <user> -P <wordlist> <IP>`

Entrambi i tool tentano un login RDP grafico. È molto lento e visibile, da usare solo in ambienti controllati (es. lab HTB o simili).

## Fase 5 – Vulnerabilità conosciute

Una delle più note è **BlueKeep** (CVE-2019-0708), che colpisce versioni non aggiornate di Windows 7, Server 2008, XP.

Per verificarla:

`nmap -p 3389 --script rdpscan <IP>`

Oppure, usa il modulo Metasploit:

`use auxiliary/scanner/rdp/cve_2019_0708_bluekeep`
`set RHOSTS <IP>`
`run`

Altre vulnerabilità coinvolgono problemi con il protocollo NLA (Network Level Authentication), che se disattivato può rendere l’attacco più semplice.

## Considerazioni operative

- **Tieni traccia di ogni informazione** che ottieni dal banner o dagli errori.
- Se trovi un login valido (es. `Administrator:Spring2020!`), l’accesso RDP ti dà **controllo totale** del sistema.
- Se trovi un nome di dominio, usalo in attacchi futuri con Kerberos o LDAP.
- Se accedi via RDP e puoi copiare file, puoi **trasferire script**, **dump di hash**, **tool di escalation** direttamente.

## Conclusione

RDP è un obiettivo molto interessante, ma anche altamente protetto in ambienti reali. In laboratorio o su sistemi mal configurati, può rappresentare **una porta aperta sull’intero sistema**. L’importante è approcciarlo con metodo: scansione, informazione, bruteforce responsabile, e sfruttamento solo in ambienti consentiti.
