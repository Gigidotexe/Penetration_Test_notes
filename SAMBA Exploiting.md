# Samba Exploiting

**Samba** è un’implementazione libera del protocollo SMB (Server Message Block), che permette l’interazione tra sistemi Windows e Linux. <br>
Samba consente la condivisione di file e stampanti in rete locale ed è molto usato in ambienti aziendali misti.

Samba opera generalmente sulla porta **445 TCP**, ma storicamente anche sulla **139**, quando SMB veniva incapsulato nel protocollo NetBIOS.

Come per SSH o FTP, l’accesso alle risorse Samba è controllato tramite **username e password**. <br>
A differenza di altri protocolli, Samba può esporre delle **condivisioni anonime** o delle share mal configurate che possono essere sfruttate.

---

## 1 – Scansione e Rilevamento

Per verificare la presenza del protocollo e identificare la versione di Samba/SMB in esecuzione:

```bash
nmap -sV -p139,445 <IP>       # rileva SMB sulle porte NetBIOS e SMB Direct
```

Conoscere la versione può aiutare a cercare eventuali exploit:

```bash
searchsploit samba <versione>
```

---

## 2 – Brute Force delle Credenziali con Hydra

Se la condivisione non è anonima, possiamo tentare un attacco bruteforce:

```bash
hydra -L <userList> -P <passwordList> <IP> smb
```

---

## 3 – Enumerazione Share con SMBMap

Una volta ottenute delle credenziali valide, possiamo enumerare le condivisioni con:

```bash
smbmap -H <IP> -u <username> -p <password>
```

SMBMap mostrerà tutte le condivisioni accessibili da quell’utente, indicando i permessi di **lettura (R)**, **scrittura (W)** o **nessun accesso (-)** per ciascuna share.

> **Suggerimento:** una share con permessi `RW` può essere usata per caricare file e successivamente eseguire codice.

---

## 4 – Accesso a Share con SMBClient

**smbclient** è un tool simile a un client FTP per SMB, che consente di connettersi a una share, esplorarne il contenuto, caricare e scaricare file:

```bash
smbclient -L <IP> -U <username>     # mostra la lista delle share disponibili
```

Dopo l’inserimento della password, otterremo l’elenco delle condivisioni accessibili. Per collegarsi a una share specifica:

```bash
smbclient //<IP>/<nomeShare> -U <username>
```

Una volta dentro, si possono usare comandi come:

```bash
?          # mostra tutti i comandi disponibili
ls         # elenca i file nella directory corrente
get <file> # scarica un file
put <file> # carica un file
```

> Se viene scaricato un archivio `.tar.gz`, possiamo estrarlo con:

```bash
tar xzf file.tar.gz
```

---

## 5 – Enumerazione Approfondita con Enum4Linux

**Enum4linux** è un tool di enumerazione SMB che raccoglie molte informazioni sul target:

```bash
enum4linux -a <IP>      # esegue una scansione completa
```

L’opzione `-a` (all) raccoglie:
- Liste utenti
- Share
- Informazioni NetBIOS
- Domini e gruppi
- Policy di password

> **Nota:** fornire delle credenziali valide aumenta di molto la quantità e la qualità dei dati estratti.

---
