il servizio SMB ha due tipi di autenticazione, l’autenticazione dell’utente, che richiede un username e una password, e l’autenticazione della cartella condivisa, che richiede solo una password.
L’autenticazione con un server SMB è molto elementare e consiste nell’inviare una richiesta di autenticazione con il nome utente da autenticare e la sua password, successivamente, il server risponderà al client di dover crittografare una stringa casuale con l’hash dell’utente effettivo con cui ci si vuole autenticare. quindi il client crittograferà la stringa con l’hash dell’utente e la invierà come risposta al server SMB che controllerà la stringa verificando l’hash della stringa e se corrisponde, l’accesso viene consentito, altrimenti viene negato. 

PsExec è un sostituto del telnet che consente di eseguire processi su sistemi windows remoti utilizzando delle credenziali. la sua autenticazione avviene tramite SMB quindi possiamo usarlo per autenticarci con  il sistema target legittimamente ed eseguire comandi arbitrari sul sistema. PsExec è molto simile a RDP ma differiscono dal fatto che RDP opera con una interfaccia utente mentre PsExec consente di inviare comandi tramite CMD o inviare singoli comandi che verranno eseguiti fornendo un output. 
Per utilizzare PsExec è quindi necessario fornire delle credenziali legittime con il rispettivo hash d’utente. per ottenerle ci sono varie tecniche e la più comune e quella del brute force usando il protocollo SMB. 
per fare ciò possiamo eseguire un modulo di Metasploit chiamato `auxiliary/scanner/smb_login` 
impostando le liste degli username e le password e l’RHOST

dopo aver ottenuto le credenziali, possiamo autenticarci usando lo script python psexec.py
`psexec.py <username>@<IP> cmd.exe`
e successivamente inserire la password per poter aprire una shell cmd sul sistema target senza usare alcun exploit ma semplicemente un autenticazione legittima con protocolli windows. 

e possibile eseguire questa operazione anche con un modulo Metasploit chiamato 
`exploit/windows/smb/psexec`
impostando RHOST, username e password e dopo aver eseguito l’exploit, otterremo una sessione meterpeter che, con il comando `shell`, potrà aprire una shell windows. 
