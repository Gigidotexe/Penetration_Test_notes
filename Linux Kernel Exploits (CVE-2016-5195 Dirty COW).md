# Linux Kernel Exploiting

Gli **exploit del kernel su Linux** sono strumenti o tecniche utilizzati per sfruttare vulnerabilità nei componenti del **kernel**, ovvero il cuore del sistema operativo. Questi exploit permettono di ottenere **privilegi elevati** (come root) partendo da un contesto con permessi limitati.

Sono fondamentali nei casi in cui si ha accesso a un sistema ma non si dispone dei privilegi necessari per eseguire determinate operazioni.

---

## 1 – Introduzione alla privilege escalation via kernel

Ogni exploit di questo tipo è **specifico per una determinata versione del kernel**, quindi è essenziale identificare esattamente:
- la versione del kernel in uso,
- l’architettura del sistema (32/64 bit),
- la distribuzione (Ubuntu, CentOS, ecc.).

Il processo di privilege escalation su Linux segue generalmente questi passi:
- Identificazione delle vulnerabilità,
- Ricerca degli exploit compatibili,
- Upload e compilazione del codice sulla macchina target.

> ⚠️ Lavorare con exploit del kernel è pericoloso: possono mandare in crash il sistema o corrompere dati.

---

## 2 – Linux Exploit Suggester

**Linux-Exploit-Suggester** è uno script che analizza la configurazione e il kernel della macchina target per suggerire exploit noti compatibili. Non si occupa di sicurezza mal configurata, ma **di vulnerabilità locali** del kernel.

É scaricabile su <a href="https://github.com/The-Z-Labs/linux-exploit-suggester">GitHub</a>

Dopo aver ottenuto una sessione Meterpeter sul target, possiamo caricare lo script con:

```bash
upload ~/Linux-Enum/les.sh
```

Poi, apriamo una shell e successivamente una bash:
```bash
shell
/bin/bash -i       # Avvia una shell interattiva bash
```
adesso possiamo dare i permessi di esecuzione allo script `lsa.sh` per poi eseguirlo: 
```
chmod +x les.sh     # Rende eseguibile lo script
./les.sh            # Esegue lo script
```

É importante prestare attenzione alle prime righe che mostreranno mostreranno:
- **Kernel version**
- **Architecture**
- **Distribution**
- **Version**

Usiamo queste info per cercare exploit su <a href="https://www.exploit-db.com/">Exploit Database</a>

---

## 3 – Exploit CVE-2016-5195 (Dirty COW)

Una vulnerabilità **critica** del kernel Linux chiamata **Dirty COW** (Copy-On-Write), indicata come **CVE-2016-5195**, consente a un utente non privilegiato di **scrivere in aree di memoria riservate** e ottenere accesso root. 

Dirty COW è dovuta a un errore nella gestione della memoria COW (Copy-On-Write): un utente può modificare file in sola lettura mappati in memoria.

### Preparazione dell’exploit

1. Scarichiamo il codice C dell’exploit da <a href="https://github.com/dirtycow/dirtycow.github.io/blob/master/pokemon.c">GitHub</a>

2. Carichiamolo sul target con Meterpreter:
```bash
upload pokemon.c
```

3. Compiliamo il file sul target:
```bash
gcc -pthread pokemon.c -o dirty -lcrypt
```

- `gcc` → il compilatore C
- `-pthread` → abilita i thread POSIX
- `-o dirty` → output binario chiamato "dirty"
- `-lcrypt` → collega la libreria per criptare la password del nuovo utente

### Esecuzione dell’exploit

Il binario richiede una password come argomento:
```bash
./dirty <password>
```

Il payload creerà un nuovo utente chiamato **firefart** con privilegi di root e password specificata.

Per verificarlo:
```bash
cat /etc/passwd
```

---

## 4 – Accesso con i nuovi privilegi

Possiamo connetterci via SSH con:
```bash
ssh firefart@<IP>
```

Poi inseriamo la password che abbiamo scelto durante l’exploit. 
Se la connessione è corretta, avremo accesso **root** sulla macchina target.

---
