# SSH Enumeration

SSH, o Secure Shell, è un protocollo crittografico che permette di accedere da remoto a una macchina, tipicamente Linux o Unix-like, in modo sicuro. La porta di default è la `22/TCP`. SSH è uno dei servizi più comuni e, se mal configurato, può rappresentare un punto di ingresso diretto in un sistema.

## Perché l’enumerazione SSH è importante

Durante un penetration test, il fatto che SSH sia aperto significa potenzialmente **accesso da remoto** alla macchina. Se riusciamo a trovare delle credenziali valide, possiamo entrare nel sistema con una shell completa e interattiva.

Non esistono "vulnerabilità" nel protocollo SSH in sé se è aggiornato, ma ci sono altri punti deboli da cercare:

- Versioni vecchie e non aggiornate del server OpenSSH.
- Utenti con password deboli.
- Accesso permesso per l’utente `root`.
- File `.ssh` accessibili da altre parti del sistema.
- Servizi SSH configurati senza restrizioni di IP o login.

## Fase 1 – Riconoscere il servizio

Se durante una scansione con Nmap identifichi la porta 22 aperta, hai di fronte un servizio SSH. Un primo comando da usare è:

`nmap -sV -p 22 <IP>`

Questo ti dice quale versione del server SSH è in uso. Ad esempio, potresti ottenere:

`22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 (Ubuntu Linux; protocol 2.0)`

Se la versione è vecchia, puoi cercare vulnerabilità note associate (CVE) su siti come Exploit-DB o CVE Details.

## Fase 2 – Tentare login (solo con autorizzazione!)

Se hai una lista di nomi utente o password, puoi provare a effettuare un login.

Un classico attacco è il brute force con `hydra`:

`hydra -l <username> -P <wordlist> ssh://<IP>`

Spiegazione dei parametri:

- `-l`: username singolo
- `-P`: file di password (wordlist)
- `ssh://`: indica il protocollo
- `<IP>`: l’indirizzo target

Esempio:

`hydra -l root -P /usr/share/wordlists/rockyou.txt ssh://192.168.1.10`

Il successo si ottiene quando Hydra trova una combinazione valida e mostra

`[22][ssh] host: <IP> login: root password: toor`.

## Fase 3 – Uso di Metasploit

Metasploit include un modulo utile:

`use auxiliary/scanner/ssh/ssh_login`
`set RHOSTS <IP>`
`set USERNAME <utente>`
`set PASS_FILE <path_wordlist>`
`run`

In alternativa:

- `ssh_enumusers` → per vedere se gli utenti esistono (basato sui tempi di risposta).
- `ssh_version` → per ottenere info dettagliate sulla versione SSH.

## Fase 4 – Comportamenti da osservare

Quando accedi o analizzi un sistema con SSH attivo, considera:

- Il server permette il login diretto dell’utente `root`? (È un segnale di cattiva configurazione.)
- C’è un banner personalizzato che fornisce dettagli sul sistema?
- Puoi trovare chiavi SSH (`id_rsa`, `id_dsa`) in home directory di altri utenti? (Se hai accesso al sistema da altri vettori.)
- La configurazione `PermitRootLogin yes` è attiva in `/etc/ssh/sshd_config`?

Tutte queste informazioni aiutano a capire quanto sia sicuro (o insicuro) l’ambiente SSH target.

## Cosa fare se trovi chiavi private

Se trovi una chiave `id_rsa`, puoi provare a usarla per accedere con:

`ssh -i id_rsa <utente>@<IP>`

Puoi anche convertirla in hash con `ssh2john` per poi passarla a `john`:

`ssh2john id_rsa > rsa_hash.txt`
`john rsa_hash.txt --wordlist=<tuo dizionario>`

## Considerazioni finali

SSH è un servizio sicuro, ma solo se configurato correttamente. Le falle più comuni non sono nel protocollo, ma:

- Nelle password scelte dagli utenti
- Nella configurazione (`PermitRootLogin`, `PasswordAuthentication`)
- Nella gestione delle chiavi private e file `.ssh`

Un buon pentester sa che basta un accesso SSH con un account non privilegiato per avviare l’escalation di privilegi e compromettere l’intero sistema.
